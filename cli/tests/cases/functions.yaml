name: "Functions"
cases:
  - name: "Basic function invocation"
    test_files:
      - path: "script.sh"
        contents: |
          myfunc() {
              echo "In myfunc()."
          }
          echo "Calling myfunc()..."
          myfunc
          echo "Returned."
    args: ["./script.sh"]

  - name: "Function invocation with args"
    test_files:
      - path: "script.sh"
        contents: |
          myfunc() {
              echo "In myfunc()"
              echo "1: $1"
              echo "*: $*"
          }
          echo "Calling myfunc()..."
          myfunc a b c
          echo "Returned."
    args: ["./script.sh"]

  - name: "Function invocation with empty arg"
    stdin: |
      myfunc() {
          echo "count: ${#*}"
          echo "\$1: $1"
          echo "\$2: $2"
          echo "\$3: $3"
      }

      myfunc a b c
      myfunc a "" c

  - name: "Return in function"
    test_files:
      - path: "script.sh"
        contents: |
          myfunc() {
              echo "In myfunc()"
              return 5
              echo "Should not get here"
          }
          echo "Calling myfunc()..."
          myfunc
          echo "Returned: $?"
    args: ["./script.sh"]

  - name: "Function definition with output redirection"
    stdin: |
      myfunc() {
          echo "In myfunc()"
      } >>./test.txt

      myfunc
      myfunc

  - name: "Function call with env variables"
    known_failure: true
    stdin: |
      myfunc() {
          echo ${myvar}
      }

      myvar="default"
      myfunc
      myvar="overridden" myfunc
      myfunc
